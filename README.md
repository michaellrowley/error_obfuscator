# error_obfuscator
*A cross-platform utility for obfuscating enumerations at (or before) compile-time.*

### About:
This program works by accepting a file/directory as input, iterating over any sub-files (recursively) and replacing each enumeration item with a random value based on a basic rule (whilst writing its old values to a backup file referred to as an 'acceptum' for lack of a better word).

The original version of this was written in C++ but (for some reason that eludes me) used \*nix-specific functions which then prompted me to use a ``dirent.h`` port, needless to say - it makes more sense to rewrite the whole thing as standard C++ 20, so I did.

The main use-case is to prevent (or more realistically, slow down) reverse engineering of binaries that rely on error codes/enumerated values in order to provide functionality (e.g digital rights management software that sends error codes from a client to a server but doesn't want the user to be able to identify changes in error codes between client versions).

### Example:
The below enum is an example that would be compatible with the obfuscator - the comments are to show the values that would be assigned to the enumerative items by default (at compile time, I think):
```C
// example.c
enum EXIT_CODE {
	FAILED_RESOURCES = -15,
	FAILED_TIMEOUT, // -14
	FAILED_ARGUMENT = -2,
	SUCCESS_GENERIC = 1,
	SUCCESS_PENDING/* = 2*/,
	SUCCESS_REQUESTED/* = 3 */
};
```
The below enum now represents the obfuscated version of the above one, notice how the signs (+/-) of each item remains consistent (with zero being included in the negative bounds) - the below enum would be generated by a command such as ``./error_obfuscator -p example.c -a log.acc`` (the ``-a`` argument specifies the location of the 'acceptum' that stores restoration information).
```C
// example.c
enum EXIT_CODE {
	FAILED_RESOURCES =-363247150,
	FAILED_TIMEOUT=-183338050, // -14
	FAILED_ARGUMENT =-276323401,
	SUCCESS_GENERIC =685368501,
	SUCCESS_PENDING=403237037,
	SUCCESS_REQUESTED=120544492
};
```
Which could then be converted back to the original enumeration (semantically, at least) with the ``-r`` flag being added to the aformentioned command:
```C
// example.c
enum EXIT_CODE {
	FAILED_RESOURCES =-15,
	FAILED_TIMEOUT=-14, // -14
	FAILED_ARGUMENT =-2,
	SUCCESS_GENERIC =1,
	SUCCESS_PENDING=2,
	SUCCESS_REQUESTED=3};
```
### Usage:
Although the above section goes over an example command, it's probably more useful to have each part of the command-line argument explained in its own section.

``[ [error_obfuscator_path] -p [target_path] -a [acceptum] [optional_arguments] ]``
- The 'target_path' used above would be the directory containing all of the files that should be processed or the path to the one file that should have its enum obfuscated.
- The 'acceptum' referenced is the path to an empty/nonexistent file that should be created to store the old values of each enum - if the provided path already exists and is not empty, execution will not continue (an effort to avoid accidental data-loss).
- The 'optional_arguments' refers to any argument that is not crucial to the processing of files (at the time of writing this, there is only one; ``-r``/``--restore`` which indicates that the obfuscation should be reversed using the provided 'acceptum'.)

*Note: Whilst iterating through the provided directory, if error_obfuscator encounters anything that doesn't fall under the category of being a 'regular file' or another directory (such as a symbolic link, socket, or anything else) the obfuscation process will immediately end with an error.*

### Compiling:
The compilation of this program is pretty simple across platforms as it uses C++ 20 without any additional libraries/hacky-code that breaks on certain operating systems (as far as I'm aware, anyway):
##### Windows:
To compile using Windows, you'll probably want to be using the ['Visual Studio Developer Command Prompt'](https://docs.microsoft.com/en-us/visualstudio/ide/reference/command-prompt-powershell?view=vs-2019) or Visual Studio (the latter of which may require some tweaking as there are no ``.vcxproj`` files in this repository) but the below command should run on any command-line with access to the 'CL' tool.
``cl src/main.cpp /std:c++20``
##### Linux:
By Linux, I am referring to any operating-system that runs 'g++' so that would include most major Linux distributions - the last character in the below command *may* need to be replaced from 'a' to '0' but depending on your version of 'g++' this may or may not be the case.
``g++ main.cpp -std=c++2a``

### Errors:
Handling errors isn't done in the most delicate way with this project (a fact that I intend to change when I get time) but in the meantime, users should be fairly confident that data-loss won't occur due to the processing heirarchy that is used:
1. ``example.cpp`` is renamed to ``example.cpp.bkup``
2. ``example.cpp`` and ``log_example.acc`` are created.
4. The contents of ``example.cpp.bkup`` are read, obfuscated, and then written to ``example.cpp`` whilst the old value of each item is written to ``log_example.acc``.
5. If nothing went wrong (no errors were returned to the respective handler) - ``example.cpp.bkup`` is deleted.